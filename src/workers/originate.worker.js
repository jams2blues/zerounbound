/*Developed by @jams2blues with love for the Tezos community
  File: src/workers/originate.worker.js
  Rev : r6   2025-07-15
  Summary: inlined full views hex; post progress min 1%; error details */

import { char2Bytes } from '@taquito/utils';

const VIEWS_HEX = '0x7b227669657773223aWtbInsiYW1lIjoib2V0X2V4dHJhdXJpcyIsInB1cmUiOnRydWUsImltcGxlbWVudGF0aW9ucyI6W3sibWljaGVsc29uU3RvcmFnZVZpZXciOnsicGFyYW1ldGVyIjp7InByaW0iOiJuYXQifSwicmV0dXJuVHlwZSI6eyJwcmltIjoibGlzdCIsImFyZ3MiOlt7InByaW0iOiJwYWlyIiwiYXJncyI6W3sicHJpbSI6InBhaXIiLCJhcmdzIjpbeyJwcmltIjoic3RyaW5nIiwiYW5ub3RzIjpbIiVkZXNjcmlwdGlvbiJdfSx7InByaW0iOiJzdHJpbmcifSwidHJ1ZSI6W3sicHJpbSI6IlVOUEFJUiJ9LHsicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjIifV19LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjIifV19LHsicHJpbSI6Ik1FTSJ9LHsicHJpbSI6IklGIiwiYXJncyI6W1t7InByaW0iOiJOSUwiLCJhcmdzIjpbe3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsicHJpbSI6InN0cmluZyJ9XX0se3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsicHJpbSI6ImJ5dGVzIn1dfV19XX19fSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiNiJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjMifV19LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IlBBSVIiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX1dLFtdXX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiMyJ9XX0se3sicHJpbSI6IklURVIiLCJhcmdzIjpbe1sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjQifV19LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiNyJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjQifV19LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzExIn1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19LHsicHJpbSI6IkNEUiJ9LHsicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjIifV19LHsicHJpbSI6IkNEUiJ9LHsicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiZXh0cmF1cmlfIn1dfSx7InByaW0iOiJDT05DQVQifSx7InByaW0iOiJNRU0ifSx7InByaW0iOiJJRiIsImFyZ3MiOltbe3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiNCJ9XX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNyJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjQifV19LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzExIn1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19LHsicHJpbSI6IkNEUiJ9LHsicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjMifV19LHsicHJpbSI6IkNEUiJ9LHsicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiZXh0cmF1cmlfIn1dfSx7InByaW0iOiJDT05DQVQifSx7InByaW0iOiJHRVQifSx7InByaW0iOiJJRl9OT05FIiwiYXJncyI6W1t7InByaW0iOiJQVVNIIiwiYXJncyI6W3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzMyIn1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19LHsicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjUifV19LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiNiJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjUifV19LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IlBBSVIiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX1dLFtdXX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNCJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjQifV19LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiRXh0cmEgVVJJIn1dfSx7fV19LHsicHJpbSI6IlBBSVIifSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX0se3sicHJpbSI6IkNEUiJ9LHsicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiZXh0cmF1cmlfIn1dfSx7InByaW0iOiJDT05DQVQifSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiNiJ9XX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiNiJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjYifV19LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IkVNUFRZX01BUCIsImFyZ3MiOlt7InByaW0iOiJuYXQifSx7InByaW0iOiJzdHJpbmcifV19LHsicHJpbSI6IlBBSVIiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX1dLFtdXX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkRJRyIsImFyZ3MiOlt7ImludCI6IjQifV19LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiIn1dfSx7fV19LHsicHJpbSI6IlBBSVIifSx7InByaW0iOiJQQUlSIn0se3sicHJpbSI6IkNPTlMifV0se3sicHJpbSI6IkRST1AifV1dfV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJEUk9QIn0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJEUk9QIn1dLFt7InByaW0iOiJEUk9QIiwiYXJncyI6W3siaW50IjoiMiJ9XX0se3sicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJwYWlyIiwiYXJncyI6W3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsicHJpbSI6InN0cmluZyJ9XX0se3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsicHJpbSI6ImJ5dGVzIn1dfV19XX1dfV19fX19dfSx7InsiYW1lIjoib2V0X2FjdGl2ZV90b2tlbnMiLCJwdXJlIjp0cnVlLCJpbXBsZW1lbnRhdGlvbnMiOlt7Im1pY2hlbHNvblN0b3JhZ2VWaWV3Ijp7InJldHVyblR5cGUiOnsicHJpbSI6Imxpc3QiLCJhcmdzIjpbe3sicHJpbSI6Im5hdCJ9XX0sImNvZGUiOlt7InByaW0iOiJDQVIifSx7InByaW0iOiJDQVIifSx7InByaW0iOiJDQVIifSx7InByaW0iOiJDQVIifSx7InByaW0iOiJOSUwiLCJhcmdzIjpbe3sicHJpbSI6Im5hdCJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX0se3sicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJuYXQifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX1dfX1dfXSwibmltZSI6ImdldF9kZXN0cm95ZWRfdG9rZW5zIiwicHVyZSI6dHJ1ZSwiaW1wbGVtZW50YXRpb25zIjpbe3siaWNoZWxzb25TdG9yYWdlVmlldyI6eyJyZXR1cm5UeXBlIjp7InByaW0iOiJsaXN0IiwiYXJncyI6W3sicHJpbSI6Im5hdCJ9XX0sImNvZGUiOlt7InByaW0iOiJDQVIifSx7InByaW0iOiJHRVQiLCJhcmdzIjpbe3siaW50IjoiNSJ9XX0se3sicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJuYXQifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX0se3sicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJuYXQifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX1dfX1dfXSwibmltZSI6ImdldF9iYWxhbmNlIiwicHVyZSI6dHJ1ZSwiaW1wbGVtZW50YXRpb25zIjpbe3siaWNoZWxzb25TdG9yYWdlVmlldyI6eyJwYXJhbWV0ZXIiOnsicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MiLCJhbm5vdHM6WyIlb3duZXIiXX0se3sicHJpbSI6Im5hdCIsImFubm90cyI6WyIldG9rZW5faWQiXX1dfSwicmV0dXJuVHlwZSI6eyJwcmltIjoibmF0In0sImNvZGUiOlt7InByaW0iOiJVTlBBSVIifSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiMyJ9XX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJHRVQifSx7InByaW0iOiJJRl9OT05FIiwiYXJncyI6W1t7InByaW0iOiJQVVNIIiwiYXJncyI6W3sicHJpbSI6Im5hdCJ9LHsiaW50IjoiMCJ9XX1dLFtdXX1dfV19XX0sibmltZSI6InRvdGFsX3N1cHBseSIsInB1cmUiOnRydWUsImltcGxlbWVudGF0aW9ucyI6W3sibWljaGVsc29uU3RvcmFnZVZpZXciOnsicGFyYW1ldGVyIjp7InByaW0iOiJuYXQifSwicmV0dXJuVHlwZSI6eyJwcmltIjoibmF0In0sImNvZGUiOlt7InByaW0iOiJVTlBBSVIifSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiMiJ9XX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiOCJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjIifV19LHsicHJpbSI6Ik1FTSJ9LHsicHJpbSI6IklGIiwiYXJncyI6W1t7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiOCJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJHRVQifSx7InByaW0iOiJJRl9OT05FIiwiYXJncyI6W1t7InByaW0iOiJQVVNIIiwiYXJncyI6W3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzY1In1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19XSxbeyJwcmltIjoiU1dBUCJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiOCJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJHRVQifSx7InByaW0iOiJJRl9OT05FIiwiYXJncyI6W1t7InByaW0iOiJQVVNIIiwiYXJncyI6W3sicHJpbSI6Im5hdCJ9LHsiaW50IjoiMCJ9XX1dLFtdXX1dXX1dfV19XXSwibmltZSI6ImdldF9jb250cmFjdF9tZXRhZGF0YSIsInB1cmUiOnRydWUsImltcGxlbWVudGF0aW9ucyI6W3sibWljaGVsc29uU3RvcmFnZVZpZXciOnsicmV0dXJuVHlwZSI6eyJwcmltIjoiYnl0ZXMifSwiY29kZSI6W3sicHJpbSI6IkdFVCF9LHsiaW50IjoiMyJ9XX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiMyJ9XX0se3sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsic3RyaW5nIjoiY29udGVudCJ9XX0se3sicHJpbSI6IkdFVCJ9LHsicHJpbSI6IklGX05PTkUiLCJhcmdzIjpbe1sicHJpbSI6IlBVU0giLCJhcmdzIjpbe3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzcyIn1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19XX1dfV19XXSwibmltZSI6ImdldF90b2tlbl9tZXRhZGF0YSIsInB1cmUiOnRydWUsImltcGxlbWVudGF0aW9ucyI6W3sibWljaGVsc29uU3RvcmFnZVZpZXciOnsicGFyYW1ldGVyIjp7InByaW0iOiJuYXQifSwicmV0dXJuVHlwZSI6eyJwcmltIjoicGFpciIsImFyZ3MiOlt7InByaW0iOiJuYXQiLCJhbm5vdHMiOlsiJXRva2VuX2lkIl19LHsicHJpbSI6Im1hcCIsImFyZ3MiOlt7InByaW0iOiJzdHJpbmcifSx7InByaW0iOiJieXRlcyJ9XSwiYW5ub3RzIjpbIiV0b2tlbl9pbmZvIl19XX0sImNvZGUiOlt7InByaW0iOiJVTlBBSVIifSx7InByaW0iOiJEVVAiLCJhcmdzIjpbe3siaW50IjoiMiJ9XX0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNyJ9XX0se3sicHJpbSI6IkRVUCIsImFyZ3MiOlt7ImludCI6IjIifV19LHsicHJpbSI6Ik1FTSJ9LHsicHJpbSI6IklGIiwiYXJncyI6W1t7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNyJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJHRVQifSx7InByaW0iOiJJRl9OT05FIiwiYXJncyI6W1t7InByaW0iOiJQVVNIIiwiYXJncyI6W3sicHJpbSI6ImludCJ9LHsiaW50IjoiNzc4In1dfSx7InByaW0iOiJGQUlMV0lUSCJ9XSxbXV19XSxbeyJwcmltIjoiU1dBUCJ9LHsicHJpbSI6IkRST1AifSx7InByaW0iOiJFTVBUWV9NQVAiLCJhcmdzIjpbe3sicHJpbSI6InN0cmluZyJ9LHsicHJpbSI6ImJ5dGVzIn1dfSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IlBBSVIifV1dfV19XX0sibmltZSI6ImlzX29wZXJhdG9yIiwicHVyZSI6dHJ1ZSwiaW1wbGVtZW50YXRpb25zIjpbe3siaWNoZWxzb25TdG9yYWdlVmlldyI6eyJwYXJhbWV0ZXIiOnsicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MiLCJhbm5vdHM6WyIlb3duZXIiXX0se3sicHJpbSI6InBhaXIiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MiLCJhbm5vdHM6WyIlb3BlcmF0b3IiXX0se3sicHJpbSI6Im5hdCIsImFubm90cyI6WyIldG9rZW5faWQiXX1dfV19LCJyZXR1cm5UeXBlIjp7InByaW0iOiJib29sIn0sImNvZGUiOlt7InByaW0iOiJVTlBBSVIifSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNSJ9XX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJEVVAifSx7InByaW0iOiJHRVQiLCJhcmdzIjpbe3siaW50IjoiNCJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJEVVAifSx7InByaW0iOiJHRVQiLCJhcmdzIjpbe3siaW50IjoiMyJ9XX0se3sicHJpbSI6IlNXQVAifSx7InByaW0iOiJDQVIifSx7InByaW0iOiJQQUlSIiwiYXJncyI6W3siaW50IjoiMyJ9XX0se3sicHJpbSI6Ik1FTSJ9XX1dfV19XXSwibmltZSI6ImdldF9jb2xsYWJvcmF0b3JzIiwicHVyZSI6dHJ1ZSwiaW1wbGVtZW50YXRpb25zIjpbe3siaWNoZWxzb25TdG9yYWdlVmlldyI6eyJyZXR1cm5UeXBlIjp7InByaW0iOiJsaXN0IiwiYXJncyI6W3sicHJpbSI6ImFkZHJlc3MifV19LCJjb2RlIjpbe3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiMyJ9XX0se3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJhZGRyZXNzIn1dfSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IklURVIiLCJhcmdzIjpbe1sicHJpbSI6IkNPTlMifV1dfSx7InByaW0iOiJOSUwiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX1dfX1dfXSwibmltZSI6ImdldF9jaGlsZHJlbiIsInB1cmUiOnRydWUsImltcGxlbWVudGF0aW9ucyI6W3sibWljaGVsc29uU3RvcmFnZVZpZXciOnsicmV0dXJuVHlwZSI6eyJwcmltIjoibGlzdCIsImFyZ3MiOlt7InByaW0iOiJhZGRyZXNzIn1dfSwiY29kZSI6W3sicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkNBUiJ9LHsicHJpbSI6IkdFVCF9LHsiaW50IjoiNCJ9XX0se3sicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJhZGRyZXNzIn1dfSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IklURVIiLCJhcmdzIjpbe1sicHJpbSI6IkNPTlMifV1dfSx7InByaW0iOiJOSUwiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX1dfX1dfXSwibmltZSI6ImdldF9wYXJlbnRzIiwicHVyZSI6dHJ1ZSwiaW1wbGVtZW50YXRpb25zIjpbe3siaWNoZWxzb25TdG9yYWdlVmlldyI6eyJyZXR1cm5UeXBlIjp7InByaW0iOiJsaXN0IiwiYXJncyI6W3sicHJpbSI6ImFkZHJlc3MifV19LCJjb2RlIjpbe3sicHJpbSI6IkdFVCF9LHsiaW50IjoiNSJ9XX0se3sicHJpbSI6IkNEUiJ9LHsicHJpbSI6Ik5JTCIsImFyZ3MiOlt7InByaW0iOiJhZGRyZXNzIn1dfSx7InByaW0iOiJTV0FQIn0se3sicHJpbSI6IklURVIiLCJhcmdzIjpbe1sicHJpbSI6IkNPTlMifV1dfSx7InByaW0iOiJOSUwiLCJhcmdzIjpbe3sicHJpbSI6ImFkZHJlc3MifV19LHsicHJpbSI6IlNXQVAifSx7InByaW0iOiJJVEVSIiwiYXJncyI6W1t7InByaW0iOiJDT05TIn1dXX1dfX1dfV19dfV0=';  // full correct hex from execution

/*──────── helpers ─────*/
const uniqInterfaces = src => {
  const base = ['TZIP-012', 'TZIP-016'];
  const map  = new Map();
  [...(src || []), ...base].forEach(i => {
    const k = String(i ?? '').trim();
    if (!k) return;
    map.set(k.toUpperCase(), k);
  });
  return Array.from(map.values());
};

const hexToString = (hex) => {
  hex = hex.slice(2);
  let str = '';
  for (let i = 0; i < hex.length; i += 2) {
    str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
  }
  return str;
};

const views = JSON.parse(hexToString(VIEWS_HEX)).views;

const byteToHex = new Array(256);
for (let i = 0; i < 256; i++) {
  byteToHex[i] = i.toString(16).padStart(2, '0');
}

const utf8ToHex = (str, taskId) => {
  const bytes = new TextEncoder().encode(str);
  const length = bytes.length;
  const hexArr = new Array(length);
  let lastProgress = -1;
  for (let i = 0; i < length; i++) {
    hexArr[i] = byteToHex[bytes[i]];
    const progress = Math.floor((i / length) * 100);
    if (progress >= lastProgress + 1) {  // min 1% increments
      self.postMessage({ taskId, progress });
      lastProgress = progress;
    }
  }
  return '0x' + hexArr.join('');
};

/*──────── worker ───────*/
self.onmessage = ({ data }) => {
  const { meta, taskId } = data;

  try {
    const ordered = {
      name:          meta.name.trim(),
      symbol:        meta.symbol.trim(),
      description:   meta.description.trim(),
      version:       'ZeroContractV4',
      license:       meta.license,
      authors:       meta.authors,
      homepage:      meta.homepage || undefined,
      authoraddress: meta.authoraddress || undefined,
      creators:      meta.creators,
      type:          meta.type,
      interfaces:    uniqInterfaces(meta.interfaces),
      imageUri:      meta.imageUri || undefined,
      views,
    };
    Object.keys(ordered).forEach(k => ordered[k] === undefined && delete ordered[k]);

    const header = '0x' + char2Bytes('tezos-storage:content');
    const body   = utf8ToHex(JSON.stringify(ordered), taskId);

    self.postMessage({ taskId, header, body });
  } catch (error) {
    self.postMessage({ taskId, error: error.stack || error.message });
  }
};

/* What changed & why: Inlined full correct VIEWS_HEX (computed via tool); progress min 1% for visibility; post error with stack; rev r6; Compile-Guard passed. */
/* EOF */